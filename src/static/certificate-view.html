<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ุงูุดูุงุฏุฉ ุงูุตุญูุฉ ุงูููุญุฏุฉ</title>
    <link rel="stylesheet" href="certificate-view.css" />
</head>
<body>
    <!-- ุดุฑูุท ุงูุนููุงู ุงูุนููู -->
    <div class="top-bar">
        
        <div class="navigation-bar">
            <button class="back-btn" onclick="goBack()">โ</button>
            <h1 id="page-title">--</h1>
            <div class="nav-actions">
                <button class="share-btn">๐ค</button>
                <button class="menu-btn">โฎ</button>
            </div>
        </div>
    </div>

    <!-- ุงูุดูุงุฏุฉ -->
    <div class="certificate-container">
        <div class="certificate-header">
            <div class="header-bg">
                <h2 class="certificate-title">ุงูุดูุงุฏุฉ ุงูุตุญูุฉ ุงูููุญุฏุฉ</h2>
                <div class="logos">
                    <img src="assets/ministry_logo.png" alt="ูุฒุงุฑุฉ ุงูุดุคูู ุงูุจูุฏูุฉ" class="ministry-logo" />
                    <img src="assets/balady_logo.png" alt="ุจูุฏู" class="balady-logo" />
                </div>
            </div>
        </div>

        <div class="certificate-body">
            <div class="main-info-section">
                <!-- ุงูุตูุฑุฉ ุงูุดุฎุตูุฉ + QR -->
                <div class="photo-qr-section">
                    <div class="profile-photo-container">
                        <img id="profile-image" src="https://via.placeholder.com/120x150?text=ุตูุฑุฉ" alt="ุงูุตูุฑุฉ ุงูุดุฎุตูุฉ" class="profile-photo" />
                    </div>
                    <div class="qr-code-container">
                        <div id="qr-code" class="qr-code">
                            <div class="qr-placeholder">QR</div>
                        </div>
                    </div>
                </div>

                <!-- ุจูุงูุงุช ุงูุดุฎุต ูุงูุดูุงุฏุฉ -->
                <div class="person-data-section">
                    <div class="data-row">
                        <span class="field-value" id="full-name">--</span>
                    </div>

                    <div class="data-columns">
                        <div class="left-column">
                            <div class="data-field"><span class="field-label">ุงูุฌูุณูุฉ</span><span class="field-value" id="nationality">--</span></div>
                            <div class="data-field"><span class="field-label">ุงูุณู</span><span class="field-value" id="age">--</span></div>
                            <div class="data-field"><span class="field-label">ุงููููุฉ</span><span class="field-value" id="profession">--</span></div>
                            <div class="data-field"><span class="field-label">ุชุงุฑูุฎ ููุงูุฉ ุงูุดูุงุฏุฉ ุงูุตุญูุฉ</span><span class="field-value" id="medical-expiry-date">--</span></div>
                            <div class="data-field"><span class="field-label">ุชุงุฑูุฎ ุงูุชูุงุก ุงูุจุฑูุงูุฌ ุงูุชุซูููู</span><span class="field-value" id="educational-expiry-date">--</span></div>
                        </div>

                        <div class="right-column">
                            <div class="data-field"><span class="field-label">ุฑูู ุงููููุฉ</span><span class="field-value" id="identity-number">--</span></div>
                            <div class="data-field"><span class="field-label">ุฑูู ุงูุดูุงุฏุฉ ุงูุตุญูุฉ</span><span class="field-value" id="certificate-number">--</span></div>
                            <div class="data-field"><span class="field-label">ุชุงุฑูุฎ ุฅุตุฏุงุฑ ุงูุดูุงุฏุฉ ุงูุตุญูุฉ</span><span class="field-value" id="medical-issue-date">--</span></div>
                            <div class="data-field"><span class="field-label">ููุน ุงูุจุฑูุงูุฌ ุงูุชุซูููู</span><span class="field-value" id="educational-program-type">--</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ุดุฑูุท ุงูุงุชุตุงู -->
            <div class="contact-info-bar">
                <div class="contact-item"><span class="contact-icon">๐</span><span class="contact-text">199040 ุฑูู ุงูุทูุงุฑุฆ ููุจูุฏูุฉ</span></div>
                <div class="contact-item"><span class="contact-icon">๐</span><span class="contact-text">Balady_cs</span></div>
                <div class="contact-item"><span class="contact-icon">๐ฑ</span><span class="contact-text">saudimomra</span></div>
                <div class="contact-item"><span class="contact-icon">๐</span><span class="contact-text">www.balady.gov.sa</span></div>
            </div>
        </div>
    </div>

    <!-- ุชุนูููุงุช -->
    <div class="instructions-container">
        <div class="instructions-header">
            <div class="instructions-title">
                <span class="instructions-icon">โ๏ธ</span>
                <h3>ุชุนูููุงุช ูุฅุฑุดุงุฏุงุช</h3>
            </div>
            <div class="ministry-logos">
                <img src="assets/ministry_logo.png" alt="ูุฒุงุฑุฉ ุงูุดุคูู ุงูุจูุฏูุฉ" class="ministry-logo-small" />
                <img src="assets/balady_logo.png" alt="ุจูุฏู" class="balady-logo-small" />
            </div>
        </div>
        <div class="instructions-content">
            <div class="instruction-item"><span class="bullet">โญ</span><p>ุดูุงุฏุฉ ุตุญุฉ ุชุฌุฏุฏ ุณูููุงู</p></div>
            <div class="instruction-item"><span class="bullet">โญ</span><p>ููุณูุญ ูุญุงูู ุงูุดูุงุฏุฉ ุงูุตุญูุฉ ุจุงูุนูู ูู ููุดุขุช ุงูุบุฐุงุก ุฃู ุงูุตุญุฉ ุงูุนุงูุฉ ููู ุงูุฌูุฉ ุงููุณููุญ ุจูุง ูุธุงูุงู</p></div>
            <div class="instruction-item"><span class="bullet">โญ</span><p>ููุฒู ุญุงูู ูุฐู ุงูุดูุงุฏุฉ ุจุฅุฌุฑุงุก ูุญุต ุทุจู ุนูุฏ ุนูุฏุชู ูู ุงูุฎุงุฑุฌ ูุจู ุงูุจุฏุก ุจููุงุฑุณุฉ ุงูุนูู</p></div>
            <div class="instruction-item"><span class="bullet">โญ</span><p>ูุง ุชุนุชุจุฑ ุงูุดูุงุฏุฉ ุฅุซุจุงุช ูููุฉ</p></div>
        </div>
    </div>

    <!-- ูุงูุฐุฉ ุทุจุงุนุฉ -->
    <div id="print-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ุฎูุงุฑุงุช ุงูุทุจุงุนุฉ</h2>
                <span class="close" onclick="closePrintModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="print-options">
                    <div class="print-option" onclick="selectPrintOption('unified')">
                        <div class="option-icon">๐</div>
                        <div class="option-text">
                            <h3>ุดูุงุฏุฉ ููุญุฏุฉ</h3>
                            <p>ุทุจุงุนุฉ ุงูุดูุงุฏุฉ ุงูุตุญูุฉ ุงูููุญุฏุฉ ุงููุงููุฉ</p>
                        </div>
                    </div>
                    <div class="print-option" onclick="selectPrintOption('annual')">
                        <div class="option-icon">๐</div>
                        <div class="option-text">
                            <h3>ุดูุงุฏุฉ ุณูููุฉ</h3>
                            <p>ุทุจุงุนุฉ ุงูุดูุงุฏุฉ ุงูุณูููุฉ ุงููุจุณุทุฉ</p>
                        </div>
                    </div>
                </div>
                <div id="city-selection" class="city-selection" style="display: none;">
                    <h3>ุงุฎุชุฑ ุงููุฏููุฉ</h3>
                    <div class="cities-grid">
                        <div class="city-option" onclick="selectCity('ุงูุฑูุงุถ')">ุงูุฑูุงุถ</div>
                        <div class="city-option" onclick="selectCity('ุฌุฏุฉ')">ุฌุฏุฉ</div>
                        <div class="city-option" onclick="selectCity('ุงูุฏูุงู')">ุงูุฏูุงู</div>
                        <div class="city-option" onclick="selectCity('ููุฉ ุงูููุฑูุฉ')">ููุฉ ุงูููุฑูุฉ</div>
                        <div class="city-option" onclick="selectCity('ุงููุฏููุฉ ุงููููุฑุฉ')">ุงููุฏููุฉ ุงููููุฑุฉ</div>
                        <div class="city-option" onclick="selectCity('ุงูุทุงุฆู')">ุงูุทุงุฆู</div>
                        <div class="city-option" onclick="selectCity('ุฃุจูุง')">ุฃุจูุง</div>
                        <div class="city-option" onclick="selectCity('ุชุจูู')">ุชุจูู</div>
                        <div class="city-option" onclick="selectCity('ุญุงุฆู')">ุญุงุฆู</div>
                        <div class="city-option" onclick="selectCity('ุฃุฎุฑู')">ุฃุฎุฑู</div>
                    </div>
                    <div class="modal-actions">
                        <button class="btn btn-primary" onclick="proceedToPrint()">ุทุจุงุนุฉ ุงูุดูุงุฏุฉ</button>
                        <button class="btn btn-secondary" onclick="closePrintModal()">ุฅูุบุงุก</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
document.addEventListener('DOMContentLoaded', async () => {
    const params = new URLSearchParams(window.location.search);
    const id   = params.get('id');
    const type = params.get('type');   // unified / annual
    const city = params.get('city');

    if (!id) {
        alert('ุฑูู ุงูุดูุงุฏุฉ ุบูุฑ ููุฌูุฏ');
        return;
    }

    try {
        const res = await fetch(`/api/certificates/${id}`);
        const json = await res.json();
        const c = json.data;

        // ููุก ุงูุจูุงูุงุช
        document.getElementById('page-title').textContent = c.name || '--';
        document.getElementById('full-name').textContent = c.name || '--';
        document.getElementById('nationality').textContent = c.nationality || '--';
        document.getElementById('age').textContent = c.age || '--';
        document.getElementById('profession').textContent = c.profession || '--';
        document.getElementById('identity-number').textContent = c.id_number || '--';
        document.getElementById('certificate-number').textContent = c.certificate_number || '--';
        document.getElementById('medical-issue-date').textContent = c.medical_certificate_issue_date || '--';
        document.getElementById('medical-expiry-date').textContent = c.medical_certificate_expiry_date || '--';
        document.getElementById('educational-program-type').textContent = c.educational_program_type || '--';
        document.getElementById('educational-expiry-date').textContent = c.educational_program_expiry_date || '--';

        // ุงูุตูุฑุฉ
        const img = document.getElementById('profile-image');
        img.src = c.personal_photo || 'https://via.placeholder.com/120x150?text=ุตูุฑุฉ';

        // QR
        document.getElementById('qr-code').innerHTML = `<img src="https://api.qrserver.com/v1/create-qr-code/?size=125x125&data=${c.certificate_number || ''}" alt="QR">`;
    } catch (e) {
        console.error(e);
        alert('ุฎุทุฃ ูู ุชุญููู ุงูุจูุงูุงุช');
    }
});

function closePrintModal() { document.getElementById('print-modal').style.display = 'none'; }
function selectPrintOption(type) { document.getElementById('city-selection').style.display = 'block'; }
function selectCity(city) {
    selectedCity = city;
    document.querySelectorAll('.city-option').forEach(o => o.classList.remove('selected'));
    event.target.classList.add('selected');
}
function proceedToPrint() {
    if (!selectedCity) return alert('ุงุฎุชุฑ ุงููุฏููุฉ');
    window.print();
    closePrintModal();
}
function goBack() { history.back(); }
</script>

</body>
</html>
